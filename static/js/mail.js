$(document).ready(function(){jQuery.jqtab=function(b,c,a){$(b).find("li").bind(a,function(){$(this).addClass("thistab").siblings("li").removeClass("thistab");var d=$(b).find("li").index(this);$(c).children().eq(d).show().siblings().hide();return false});$(b).find("li:first").click()};$.jqtab("#tabs","#tab_conbox","click");$("#receive").jplist({itemsBox:".list",itemPath:".list-item",panelPath:".jplist-panel",noResults:".jplist-no-results"});$("#send").jplist({itemsBox:".list",itemPath:".list-item",panelPath:".jplist-panel",noResults:".jplist-no-results"})});function toggleReceive(){$("#c_send_all").hide();$("#c_receive_all").show();$("#m_show_status").val("receive");$("#receive_search").show();$("#send_search").hide();$("#set_read_button").show()}function toggleSend(){$("#c_receive_all").hide();$("#c_send_all").show();$("#m_show_status").val("send");$("#receive_search").hide();$("#send_search").show();$("#set_read_button").hide()}function toggleContentHeight(a){if($(a).next().hasClass("mail_row01")){$(a).next().removeClass("mail_row01");$(a).next().addClass("mail_row02")}else{$(a).next().removeClass("mail_row02");$(a).next().addClass("mail_row01")}}function receive_search(a){$("#jp_receive_filter").val(a);$("#jp_receive_filter").trigger("keyup")}function toggleReply(b){if($(b).children().first().text()!="发件人：system"){$(b).parent().next().slideToggle()}if(b.tagName=="H6"){var a=$(b).parent().prev().val();setRead(b,a)}}function hideReplay(a){$(a).parent().parent().slideToggle()}function toggleCheckAll(){var c=$("#m_show_status").val();var a=$("[name="+c+"][value='a']:checkbox");for(var b=0;b<a.length;b++){a[b].checked=$("[name="+c+"][value='A']:checkbox")[0].checked}}function checkAllOrNot(){var a=$("#m_show_status").val();if($("[name="+a+"][value='a']:checkbox:checked").length==$("[name="+a+"][value='a']:checkbox").length){$("[name="+a+"][value='A']:checkbox")[0].checked=true}else{$("[name="+a+"][value='A']:checkbox")[0].checked=false}}function sendReply(e){var d=$(e).parent().parent().prev().prev().val();var b=$("#m_r_reply_"+d).val();var c=$("#m_r_sender_"+d).text().split("|")[0];var a="回复： "+$("#m_r_subject_"+d).text();if(b==""){swal("请填写回复内容！")}else{$.ajax({url:"/message/",type:"POST",async:true,data:{subject:a,content:b,to_list_str:c},success:function(g){e.disabled=false;var f=JSON.parse(g);if(f.status==1){swal({title:"发送至"+c+"成功",text:"窗口将在2秒后消失",type:"success",timer:2000,showConfirmButton:false});$(e).parent().parent().slideToggle();$("#m_r_reply_"+d).val("");static_addSendItem(f.data.msgNo,c,a,b,f.data.date_send)}else{sweetAlert(f.message)}},error:function(f,h,g){e.disabled=false;sweetAlert("回复失败！错误信息："+f.statusText+"错误代码："+f.status)}})}}function getSelectedNO(){var b=$("#m_show_status").val();var d="";var c=$("[name="+b+"][value='a']:checkbox:checked").parent().prev("[name='NO.']:hidden");for(var a=0;a<c.length;a++){d+=c[a].value+","}d=d.substr(0,d.length-1);return d}function deleteMessage(){var b=$("#m_show_status").val();var a="";if(b=="receive"){a="/message/receive/"}else{if(b=="send"){a="/message/send/"}}var c=getSelectedNO();if(c==""){swal("请选择所需删除的信息")}else{swal({title:"您确定?",text:"即将删除所选信息",type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"是的，删除!",cancelButtonText:"不，取消 !",closeOnConfirm:false,closeOnCancel:false},function(d){if(d){$.ajax({url:a,type:"DELETE",data:{msgNo:c},success:function(h){var g=JSON.parse(h);if(g.status==1){swal({title:"成功删除"+g.data+"条信息",text:"窗口将在2秒后消失",type:"success",timer:2000,showConfirmButton:false});$("[name="+b+"][value='a']:checkbox:checked").parent().parent().remove();var e=$("#m_show_unread a");for(var f=0;f<e.length;f++){var j=e[f].id.split("_");if(c.indexOf(j[j.length-1])!=-1){$("#"+e[f].id).remove()}}refresh_unread_nums()}else{sweetAlert(g.message)}},error:function(e){sweetAlert("回复失败！错误信息："+e.statusText+"错误代码："+e.status)}})}else{swal("已取消","您的信息没有被修改)","error")}})}}function setRead(b,a){var c="/message/read/";if(arguments.length==2){c="/message/read?msgNo="+a}$.ajax({url:c,type:"GET",async:false,success:function(e){var d=JSON.parse(e);if(d.status==1){if(c=="/message/read/"){static_changeToRead();swal({title:"已成功将"+d.data+"条信息标记为已读",text:"窗口将在2秒后消失",type:"success",timer:2000,showConfirmButton:false});$("#m_show_unread a").remove()}else{static_changeToRead(a);$("#m_msg_"+a).remove()}refresh_unread_nums()}else{sweetAlert(d.message)}},error:function(d){swal("标记失败！错误信息："+d.statusText+"错误代码："+d.status)}})}function static_changeToRead(a){if(arguments.length){$("#m_r_"+a)[0].outerHTML=$("#m_r_"+a)[0].outerHTML.replace(new RegExp("<h6 ","g"),"<h5 ");$("#m_r_"+a)[0].outerHTML=$("#m_r_"+a)[0].outerHTML.replace(new RegExp("/h6>","g"),"/h5>")}else{$("#m_receive")[0].outerHTML=$("#m_receive")[0].outerHTML.replace(new RegExp("<h6 ","g"),"<h5 ");$("#m_receive")[0].outerHTML=$("#m_receive")[0].outerHTML.replace(new RegExp("/h6>","g"),"/h5>")}}function send_search(a){$("#jp_send_filter").val(a);$("#jp_send_filter").trigger("keyup")}function static_addSendItem(d,c,a,b,e){$("#m_send").prepend("<li id='m_s_"+d+"'><input type='hidden' name='NO.' value='"+d+"'><div class='mailSendMode'><strong>"+e+"</strong><input name='send' type='checkbox' value='a' onclick='checkAllOrNot()'/><span class='mail_userImg'><img src='/static/images/user03.png' alt=''></span><h5 onclick='toggleContentHeight(this)'><label id='m_s_receiver_"+d+"'>收件人："+c+"</label><label id='m_s_subject_"+d+"' class='subject'>&nbsp;&nbsp;主题："+a+"</label></h5><span class='mail_row01 content'>"+b+"</span></div></li>")}function toggle_user_message_set(){var a=$("#user_message_true").attr("src");$("#user_message_true").attr("src",$("#user_message_false").attr("src"));$("#user_message_false").attr("src",a)}function toggle_sys_message_set(){var a=$("#sys_message_true").attr("src");$("#sys_message_true").attr("src",$("#sys_message_false").attr("src"));$("#sys_message_false").attr("src",a)}function get_message_set_status(){var a=new Array(2);if($("#user_message_true").attr("src")=="/static/images/right_gray.png"){a[0]=0}else{a[0]=1}if($("#sys_message_true").attr("src")=="/static/images/right_gray.png"){a[1]=0}else{a[1]=1}return a.join("")}function reset_message_settings(){$.ajax({url:"/message/config/",type:"POST",data:{user_message:get_message_set_status()},success:function(a){if(a.success){sweetAlert("修改设置成功");$("#set_close").click()}else{sweetAlert(a.result.message)}},error:function(a){sweetAlert("回复失败！错误信息："+a.statusText+"错误代码："+a.status)}})};