$(function(){showWait();var a=$("#barData").val();var f=JSON.parse(a);console.log(f);for(var d=0;d<f.attributes.length;d++){var g=[];var e=[];var c=f.attributes[d]["name"]+"柱状图";for(var b=0;b<f.attributes[d]["data"].length;b++){g.push(f.attributes[d]["data"][b]["count"]);e.push(f.attributes[d]["data"][b]["key"])}drawBar("barDiv",c,e,g,700,600,"bar_"+d)}hideWait();$("#figure_0").click()});function drawBar(m,b,k,g,n,l,c){var h=d3.select("#"+m).append("svg").attr("id",c).attr("width",n).attr("height",l);var f=d3.scale.ordinal().domain(k).rangeRoundBands([0,500]);var i=d3.scale.linear().domain([0,d3.max(g)]).range([500,0]);var j=d3.scale.ordinal().domain(d3.range(k.length)).rangeRoundBands([0,500],0.1);var e=d3.scale.linear().domain([0,d3.max(g)]).range([0,500]);var d=d3.svg.axis().scale(f).orient("bottom");var a=d3.svg.axis().scale(i).orient("left");h.selectAll("rect").data(g).enter().append("rect").attr("x",function(p,o){return 30+j(o)}).attr("y",function(p,o){return 50+500-e(p)}).attr("width",function(p,o){return j.rangeBand()}).attr("height",function(p,o){return e(p)}).attr("fill","steelblue").on("click",function(p,o){d3.select(this).attr("fill","green")}).on("mouseover",function(p,o){d3.select(this).attr("fill","yellow")}).on("mouseout",function(p,o){d3.select(this).transition().duration(500).attr("fill","steelblue")});h.selectAll("text").data(g).enter().append("text").attr("x",function(p,o){return 30+j(o)}).attr("y",function(p,o){return 50+500-e(p)}).attr("dx",function(p,o){return j.rangeBand()/5}).attr("dy",15).attr("text-anchor","begin").attr("font-size",14).attr("fill","white").text(function(p,o){return p});h.append("g").attr("class","axis").attr("transform","translate(30,550)").call(d);h.append("g").attr("class","axis").attr("transform","translate(30,50)").call(a)}function showBar(a){$(".figureItem").removeClass("current");$("#figure_"+a).addClass("current");$("#bar_"+a).show().siblings("svg").hide()};