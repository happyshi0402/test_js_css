$(function(){console.log("*************************************月页面初始化************************************");var new_date=$("#new_date").val();console.log("获取的最新日期："+new_date);var new_year=myDateClass.getYear(new_date);$(".calendar_month_mode .showDate2").val(new_year);console.log("将日历2设置为："+$(".calendar_month_mode .showDate2").val());var jsondata=eval("("+$(".saveJson").val()+")");console.log("获取所有的数据为：",jsondata);var patient_no=$("#patient_no").val();var disease=$("#disease").val();var str_date=$(".calendar_month_mode .showDate").val();str_date=str_date.replace("年","-").replace("月","");traversalJson(jsondata,str_date);$(".radio_year").click(function(){go_to_year(new_year)});$(".calendar_month_mode li").click(function(){var str_date=$(".calendar_month_mode .showDate").val();str_date=str_date.replace("年","-").replace("月","");traversalJson(jsondata,str_date)});$(".pablueDay").click(function(){if($(".pablueBoxDay").is(":visible")){$("#gly_minus").removeClass("glyphicon-minus").addClass("glyphicon-plus")}else{$("#gly_minus").removeClass("glyphicon-plus").addClass("glyphicon-minus")}$(".pablueBoxDay").slideToggle("slow");if($(".purpleBoxDay").is(":visible")){$(".purpleBoxDay").slideToggle("slow");$("#gly_plus").removeClass("glyphicon-minus").addClass("glyphicon-plus")}});$(".purpleDay").click(function(){if($(".purpleBoxDay").is(":visible")){$("#gly_plus").removeClass("glyphicon-minus").addClass("glyphicon-plus")}else{$("#gly_plus").removeClass("glyphicon-plus").addClass("glyphicon-minus")}$(".purpleBoxDay").slideToggle("slow");if($(".pablueBoxDay").is(":visible")){$(".pablueBoxDay").slideToggle("slow");$("#gly_minus").removeClass("glyphicon-minus").addClass("glyphicon-plus")}})});function dayCountChage(a){var e=a.split("-");var c=parseInt(e[0]);var g=parseInt(e[1]);var h=new Date(c,g,0);var f=h.getDate();$(".DayHistory a").show();$(".DayBox span").show();$(".dayPage a").show();for(var b=0;b<17;b++){$(".DayHistory li:eq("+b+") a:gt("+(f-1)+")").hide()}for(var b=0;b<4;b++){$(".DayHistory").parent("li:eq("+b+")").children("span:gt("+(f-1)+")").hide()}$(".dayPage a:gt("+(f-1)+")").hide();$(".dayPage strong").html("共"+f+"天")}function go_to_year(d,b){var a=$("#patient_no").val();var c=$("#disease").val();showWait();$("#test_data_list").load("/sample/patient/year/"+a+"/",{disease:c},function(){hideWait()})}function traversalJson(c,b){console.log("*************************************刷新页面************************************");dayCountChage(b);console.log("开始清除span和a的class、html、所有事件……");$(".DayBox span").removeClass().html("").unbind();$(".DayHistory a").removeClass().removeAttr("data-toggle data-content data-original-title data-placement title").html("").unbind();console.log("清除完成！");console.log("开始进行月页面遍历json日期，并填色……");for(o in c.data){if(myDateClass.isInMonth(o,b)){for(p in c.data[o]){var a=myDateClass.getDay(o);test_no=c.data[o][p];addColor(a-1,p,test_no,o)}}}console.log("添加鼠标滑过显示弹窗的popover事件……");options={trigger:"manual",html:true,container:".DayBox"};$('[data-toggle="popover"]').popover(options).on("mouseenter",function(){var d=this;$(this).popover("show");$(".popover").children().addClass("triangle_box");$(".popover").addClass("blue_border").on("mouseleave",function(){$(d).popover("hide")})}).on("mouseleave",function(){var d=this;setTimeout(function(){if(!$(".popover:hover").length){$(d).popover("hide")}},100)});console.log("popover事件添加完成！")}function addColor(j,a,c,b){var g=$("#"+a).parents("li").children("span:eq("+j+")");if(g.html()==""){var e=0}else{e=parseInt(g.html())}g.html(e+1);var d=$("#"+a).parent().parent();if(d.hasClass("pablueBoxDay")){g.addClass("paBlueTitle")}else{if(d.hasClass("purpleBoxDay")){g.addClass("purpleTitle")}else{if(d.hasClass("geneticBoxDay")){g.addClass("geneticTitle")}else{if(d.hasClass("treatBoxDay")){g.addClass("treatTitle")}}}}$("#"+a).parents("li").children("span:eq("+j+")").unbind("click").click(function(){$("#"+a).parents("li").children("h6").children("a").click()});var i=$("#"+a+" a:eq("+j+")");if(i.html()==""){var f=0}else{f=parseInt(i.html())}i.html(f+1);if(d.hasClass("pablueBoxDay")){i.addClass("paBlueBlock")}else{if(d.hasClass("purpleBoxDay")){i.addClass("purpleBlock")}else{if(d.hasClass("geneticBoxDay")){i.addClass("geneticBlock")}else{if(d.hasClass("treatBoxDay")){i.addClass("treatBlock")}}}}i.attr("data-toggle","popover").attr("data-placement","right");var h=$("#"+a+" a:eq("+j+")").attr("data-content")==undefined?"":$("#"+a+" a:eq("+j+")").attr("data-content");h+='<div class="patient_mouse_content">';h+="<p>类型：<span>"+$("#"+a).children("strong").html()+"</span></p>";h+='<p style="display:none">编号：<span>'+c+"</span></p>";h+="<p>时间：<span>"+b+'</span></p><a onclick="triggerMotal(this)">查看详细</a></div>';i.attr("data-content",h)}function triggerMotal(b){var a=$(b).parent(".patient_mouse_content").find("span:eq(1)").html();var c=$(b).parent(".patient_mouse_content").find("span:eq(0)").html();console.log(a+c);attribute_list(a,c)}function attribute_list(b,c){showWait();var a=$("#patient_no").val();url="/sample/patient/"+a+"/"+b+"/";$.ajax({url:url,type:"POST",data:{},success:function(i){var d=i.data;console.log(d);var g=$("#attributes_listss");var e=$("#attributes_list");e.remove();g.append($("<ul id='attributes_list'></ul>"));e=$("#attributes_list");for(key in d){var f=key;var h=d[key];var j=$("<li>"+f+":"+h+"</li>");e.append(j)}hideWait();$("#attribute_list").modal();$(".myMotalTitle").html(c)},error:function(){sweetAlert("something was wrong!")}})};