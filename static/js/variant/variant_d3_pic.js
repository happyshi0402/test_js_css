var window_width=$(window).width();var int_p=0.8;d3.select("#variant_data_sidebar").style("width",function(){if(window_width*0.2<250){int_p=1-250/window_width;return"250px"}else{return window_width*0.2+"px"}});int_variant_data_table_d3=parseInt(window_width*int_p*0.95);d3.select("#variant_data_table_d3").style("width",int_variant_data_table_d3+"px");get_variant_data_pic1();function get_variant_data_pic1(){var a=int_variant_data_table_d3/2-5,j=a*1.4,c=a/50,k=a/12;var b=a/5;var i=d3.scale.linear().range([k,a-k]);var h=d3.scale.ordinal().rangeRoundBands([c,j-c],0.1);var e=d3.select("#variant_sample_quality_pic1").append("svg").attr("width",a).attr("height",j).attr("id","variant_sample_quality_pic1_id").style("background-color","#f7f7f7");var g=$("#variant_hid_sample_no").val();var f;var d;d3.json("/variant/data/qc/pic/"+g+"/",function(z){f=z.pic_data1;d=z.pic_data2;var B=1;var A=1;if(f==""){B=0}if(d==""){A=0}var s=f.split(",");var p=s.length;s[0]=s[0].replace("[","");s[p-1]=s[p-1].replace("]","");var C=[{title:"Ti/Tv Genomic",mean:1.9,test:0,max:3.8,type:0},{title:"Ti/Tv Exonic",mean:2.6,test:0,max:3.8,type:0},{title:"Median Coverage",mean:20,test:0,max:200,type:0},{title:"%SNP with QUAL>=40",mean:80,test:0,max:100,type:1},{title:"%Mapping Ratio",mean:80,test:0,max:100,type:1},{title:"%Target Ratio",mean:30,test:0,max:100,type:1}];var r=0;var q=0;for(var u=0;u<p;u++){var n=s[u];if(u<4&&parseFloat(n)>0){r++}if(u>=4&&parseFloat(n)>0){q++}C[u]["test"]=parseFloat(n)}var w=C.length;try{for(var u=0;u<w;u++){var l=[];var D=C[u]["title"];var v=C[u]["mean"];var y=C[u]["test"];var t=C[u]["max"];var m=C[u]["type"];l.push({title:D,mean:v,test:y,max:t,type:m});i.domain([0,d3.max(l,function(E){return E.max})]);var o=0;e.selectAll("text_top_text").data(l).enter().append("text").text(function(E){if(parseFloat(E.test)>parseFloat(E.mean)){o=1}return E.title}).attr("x",function(E){return i(parseFloat(E.max)/2)-E.title.length*5}).attr("y",(parseInt(u)+1)*b-8).style("font-size","14px").style("font-weight","bold").attr("fill","silver");if(o==1){set_variant_pic1_ok(i,e,l,u,b)}else{set_variant_pic1_not_ok(i,e,l,u,b)}e.selectAll("rect2").data(l).enter().append("rect").attr("x",k).attr("width",function(E){return i(E.max)-k}).attr("id",function(E){return"bar_a_"+u}).attr("y",(u+1)*b).attr("height",30).style("fill",function(E){if(B==0||(u<4&&r==0)||(u>=4&&q==0)){return"silver"}else{return"#82d0a7"}});e.selectAll("rect_bottom_blue").data(l).enter().append("rect").attr("x",function(E){return i(E.mean)}).attr("id","rect__bottom"+u).attr("y",(parseInt(u)+1)*b+28).attr("width",2).attr("height",10).style("fill",function(E){if(B==0||(u<4&&r==0)||(u>=4&&q==0)){return"silver"}else{return"#00CC99"}});var x=[{mean:0},{mean:l[0]["mean"]},{mean:l[0]["max"]}];e.selectAll("text_bottom_text").data(x).enter().append("text").text(function(E){return(E.mean)}).attr("x",function(F){var E=0;if(F.mean.toString().length>=0){E=4*(F.mean.toString().length)}return i(F.mean)-E}).attr("y",(parseInt(u)+1)*b+48).style("font-size","8px");e.selectAll("rect3").data(l).enter().append("rect").attr("x",k).attr("width",function(E){return i(E.mean)-k}).attr("id",function(E){return"bar_b_"+u}).attr("y",(u+1)*b).attr("height",30).style("fill",function(E){if(B==0||(u<4&&r==0)||(u>=4&&q==0)){return"silver"}else{return"#fd856d"}});if((u<4&&r>0)||(u>=4&&q>0)){set_variant_pic1_test_data(e,i,h,l,u,b)}}}finally{svg_variant_pic2_BarChart(d,A)}})}function set_variant_pic1_test_data(b,a,f,d,c,e){b.selectAll("rect_test").data(d).enter().append("rect").attr("x",function(g){return a(g.test)}).attr("id","rect_test"+c).attr("y",(parseInt(c)+1)*e+25).attr("width",3).attr("height",10).style("fill","black");b.selectAll("text_test").data(d).enter().append("text").text(function(g){return g.test}).attr("id","text_test"+c).attr("x",function(i){var h=i.test.toString().length;var g=3*parseInt(h);return a(i.test)-g}).attr("y",(parseInt(c)+1)*e+20).style("font-size","8px").style("font-color","silver")}function set_variant_pic1_ok(a,b,d,c,e){b.selectAll("text_top_ok1").data(d).enter().append("line").attr("x1",function(f){return a(parseFloat(f.max)/2)+parseFloat(f.title.length)*5-16}).attr("y1",(parseInt(c)+1)*e-12).attr("x2",function(f){return a(parseFloat(f.max)/2)+parseFloat(f.title.length)*5-10}).attr("y2",(parseInt(c)+1)*e-6).attr("stroke","#00CC99").attr("stroke-width","1.5");b.selectAll("text_top_ok2").data(d).enter().append("line").attr("x1",function(f){return a(parseFloat(f.max)/2)+parseFloat(f.title.length)*5-10-0.5}).attr("y1",(parseInt(c)+1)*e-6-0.5).attr("x2",function(f){return a(parseFloat(f.max)/2)+parseFloat(f.title.length)*5+2}).attr("y2",(parseInt(c)+1)*e-18).attr("stroke","#00CC99").attr("stroke-width","1.5")}function set_variant_pic1_not_ok(a,b,d,c,e){b.selectAll("text_top_not_ok1"+c).data(d).enter().append("line").attr("x1",function(f){return a(parseFloat(f.max)/2)+parseFloat(f.title.length)*5-12}).attr("y1",(parseInt(c)+1)*e-18).attr("x2",function(f){return a(parseFloat(f.max)/2)+parseFloat(f.title.length)*5-2}).attr("y2",(parseInt(c)+1)*e-8).attr("stroke","silver").attr("stroke-width","1.5");b.selectAll("text_top_not_ok2"+c).data(d).enter().append("line").attr("x1",function(f){return a(parseFloat(f.max)/2)+parseFloat(f.title.length)*5-12}).attr("y1",(parseInt(c)+1)*e-8).attr("x2",function(f){return a(parseFloat(f.max)/2)+parseFloat(f.title.length)*5-2}).attr("y2",(parseInt(c)+1)*e-18).attr("stroke","silver").attr("stroke-width","1.5")}function svg_variant_pic2_BarChart(d,g){if(g==0){var k=[];var l=[];var a=5;for(var f=0;f<50;f++){k.push({to:(f+1)*a,per:0})}for(var f=25;f<250;f++){if(f%25==0){l.push(f)}}}else{var c=jQuery.parseJSON(d);var e=c[0]["data"];var j=c[0]["x-lable"];var h=c[0]["y-lable"];var b=e.length;var k=[];var l=[];var a=5;for(var f=0;f<b;f++){k.push({to:(f+1)*a,per:e[f]["y"]})}for(var f=25;f<250;f++){if(f%25==0){l.push(f)}}}set_variant_pic2_method(k,l,j,h)}function set_variant_pic2_method(e,m,k,h){var c=int_variant_data_table_d3/2-5,l=c*0.92,d=20,n=80;var j=d3.scale.ordinal().rangeBands([n-d,c-d],0.1);var i=d3.scale.linear().range([l-d,d]);var b=d3.svg.axis().scale(i).orient("left");var g=d3.select("#variant_sample_quality_pic2").append("svg").attr("width",c).attr("height",l);j.domain(e.map(function(o){return o.to}));i.domain([0,d3.max(e,function(o){return o.per})]);var a=d3.scale.ordinal().rangeRoundBands([n-d,c-d],1);var f=d3.svg.axis().scale(a).orient("bottom");a.domain(m.map(function(o){return o}));g.append("g").attr("class","axis").attr("transform","translate(0, "+(l-d)+")").call(f);g.append("g").attr("class","axis").attr("transform","translate("+(n-d)+", 0)").call(b);g.selectAll("rect").data(e).enter().append("rect").attr("class","bar").style("fill","#61B8DC").attr("x",function(o){return j(o.to)}).attr("width",j.rangeBand()).attr("y",l-d).transition("translate("+(n-d)+", 0)").duration(800).attr("y",function(o){return i(o.per)}).attr("height",function(o){return l-d-i(o.per)})};