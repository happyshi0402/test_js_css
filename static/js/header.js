$(function(){$(".addbs,#addbs .affirm,#addbs .cancel").click(function(){$("#display_level").val(1);if($(".pop_addbs").css("display")=="none"){$(".pop_addbs").show()}else{$(".pop_addbs").hide()}});$("#head_add_project").click(function(){set_value_for_new_project()});$("#submit_add_project").click(function(){add_project()});$("#submit_edit_project").click(function(){edit_project()});$("#project_name").focus(function(){$("#project_project_name_tag").text("")});$("#description").focus(function(){$("#project_description_tag").text("")});$("#dis_ne").click(function(){$("#dis_no").slideDown("slow");var b=$("#sample_patient_no").val();$("#sample_case_no").val(b);var a="/get/project/"+b+"/ajax/";if(b){$.ajax({url:a,type:"POST",data:{},success:function(f){if(f.status==1){var c=f.data;var g=c.patient_name;var e=c.sex;var d=c.age;if(e==1){$("#sample_patient_sex").val(1);$("#man").attr("src","/static/images/right_green.png");$("#woman").attr("src","/static/images/right_gray.png");$("#sexNone").attr("src","/static/images/right_gray.png")}else{if(e==2){$("#sample_patient_sex").val(2);$("#woman").attr("src","/static/images/right_green.png");$("#man").attr("src","/static/images/right_gray.png");$("#sexNone").attr("src","/static/images/right_gray.png")}else{$("#sample_patient_sex").val(0);$("#man").attr("src","/static/images/right_gray.png");$("#woman").attr("src","/static/images/right_gray.png");$("#sexNone").attr("src","/static/images/right_green.png")}}if($("#woman").data("click")){$("#woman").unbind("click")}if($("#man").data("click")){$("#man").unbind("click")}if($("#sexNone").data("click")){$("#sexNone").unbind("click")}$("#sample_patient_name").val(g);$("#sample_patient_age").val(d);$("#sample_patient_name").attr("disabled","disabled");$("#sample_patient_age").attr("disabled","disabled");$("#sample_case_no").attr("disabled","disabled")}else{$("#woman").attr("src","/static/images/right_gray.png");$("#man").attr("src","/static/images/right_gray.png");$("#sexNone").attr("src","/static/images/right_gray.png");if(!$("#woman").data("click")){$("#woman").bind("click",function(){$("#sample_patient_sex").val(2);$("#woman").attr("src","/static/images/right_green.png");$("#man").attr("src","/static/images/right_gray.png");$("#sexNone").attr("src","/static/images/right_gray.png")})}if(!$("#man").data("click")){$("#man").bind("click",function(){$("#sample_patient_sex").val(1);$("#man").attr("src","/static/images/right_green.png");$("#woman").attr("src","/static/images/right_gray.png");$("#sexNone").attr("src","/static/images/right_gray.png")})}if(!$("#sexNone").data("click")){$("#sexNone").bind("click",function(){$("#sample_patient_sex").val(0);$("#man").attr("src","/static/images/right_gray.png");$("#woman").attr("src","/static/images/right_gray.png");$("#sexNone").attr("src","/static/images/right_green.png")})}$("#sample_patient_name").val("");$("#sample_patient_age").val("");$("#sample_patient_name").removeAttr("disabled");$("#sample_patient_age").removeAttr("disabled");$("#sample_case_no").removeAttr("disabled")}},error:function(){swal("Something was wrong!")}})}else{$("#woman").attr("src","/static/images/right_gray.png");$("#man").attr("src","/static/images/right_gray.png");$("#sexNone").attr("src","/static/images/right_gray.png");if(!$("#woman").data("click")){$("#woman").bind("click",function(){$("#sample_patient_sex").val(2);$("#woman").attr("src","/static/images/right_green.png");$("#man").attr("src","/static/images/right_gray.png");$("#sexNone").attr("src","/static/images/right_gray.png")})}if(!$("#man").data("click")){$("#man").bind("click",function(){$("#sample_patient_sex").val(1);$("#man").attr("src","/static/images/right_green.png");$("#woman").attr("src","/static/images/right_gray.png");$("#sexNone").attr("src","/static/images/right_gray.png")})}if(!$("#sexNone").data("click")){$("#sexNone").bind("click",function(){$("#sample_patient_sex").val(0);$("#man").attr("src","/static/images/right_gray.png");$("#woman").attr("src","/static/images/right_gray.png");$("#sexNone").attr("src","/static/images/right_green.png")})}$("#sample_patient_name").val("");$("#sample_patient_age").val("");$("#sample_patient_name").removeAttr("disabled");$("#sample_patient_age").removeAttr("disabled");$("#sample_case_no").removeAttr("disabled")}});$("#sam_private").click(function(){$("#sample_display_level").val(2);$("#sam_private img").attr("src","/static/images/right_green.png");$("#sam_public img").attr("src","/static/images/right_gray.png")});$("#sam_public").click(function(){$("#sample_display_level").val(0);$("#sam_private img").attr("src","/static/images/right_gray.png");$("#sam_public img").attr("src","/static/images/right_green.png")});$("#sam_private").click();get_inside();setInterval(get_inside,30000)});function navigate_to_project(b){if(window.location.href.match("/project/#")){var a=window.location.href.split("#")[1];if(b==0){$("ol.breadcrumb li:last").replaceWith("<li><a class='active' href='/project/#0'>我的项目</a></li>");$("#bt_my_project").addClass("on").addClass("active");$("#bt_public_project").removeClass("on").removeClass("active");$("#public_project").removeClass("in active");$("#my_project").addClass("in active");$("#my_project").load("/project/list/mine/",function(){project_model_array[0]=1})}else{$("ol.breadcrumb li:last").replaceWith("<li><a  class='active' href='/project/#1'>公共项目</a></li>");$("#bt_public_project").addClass("on").addClass("active");$("#bt_my_project").removeClass("on").removeClass("active");$("#my_project").removeClass("in active");$("#public_project").addClass("in active");$("#public_project").load("/project/list/public/",function(){project_model_array[1]=1})}}location.assign("/project/#"+b)}function addSample(){var n=$("#sample_id").val();var h=$("#sample_case_no").val();var e="";var m=$("#phenotype_tag_div li.tag-cloud");for(var c=0;c<m.length;c++){switch(navigator.appCodeName){case"Mozilla":e+=m[c].textContent.split("(")[0]+";";break;default:e+=m[c].innerText.split("(")[0]+";"}}if(n==""){swal("请输入样本号")}else{if(h==""){swal("请输入病案号")}else{if(e==""){swal("请输入临床表征")}else{if(/[^0-9a-zA-Z_\-]/g.test(n)){swal("样本号输入数据格式不正确！")}else{var j=$("#sample_patient_name").val();var d=$("#sample_patient_age").val();var a=$("#sample_patient_sex").val();var l=$("#sample_subgroup").val();var k=$("#add_sample_project").val();var o=$("#sample_patient_no").val();var g=$("#sample_type").val();var b=$("#sample_display_level").val();var f=$("#sample_project_no").val();if(k==1){f=-1}$.ajax({url:"/sample/add/quick/",type:"POST",data:{sample_patient_no:o,sample_id:n,sample_type:g,sample_display_level:b,sample_subgroup:l,sample_phenotype_no:e,sample_project_no:f,sample_case_no:h,sample_patient_name:j,sample_patient_age:d,sample_patient_sex:a},success:function(q){if(q.success==true){$("#myModal").modal("hide");sampleFormReset();swal("样本添加成功");var t=$("#get_sample_type").val();var s=$("#pro_tab_flag").val();var p=$("#sample_tab_flag").val();if(s==3){$("#dashboard_header").load("/dashboard/header/",function(){$("#dashboard_sample").load("/dashboard/sample/",function(){})})}else{if(p=="4"){var r=q.sample_no;if(r!=null||r!=""){self.location.href="/variant/mine/"}}else{if(t=="mine"){$("#sample_detection").load("/sample/mine/detection/",function(){$("#basicInfo").load("/project/project_no/mine/"+f+"/",function(){})})}else{if(t=="public"){$("#sample_detection").load("/sample/public/detection/",function(){$("#basicInfo").load("/project/project_no/mine/"+f+"/",function(){})})}else{if(k!=1){$("#sample_detection").load("/sample/mine/detection/"+f+"/",function(){$("#basicInfo").load("/project/project_no/mine/"+f+"/",function(){})})}}}}}}else{$("#myModal").modal("hide");swal(q.result.message)}},error:function(){$("#myModal").modal("hide");swal("Something was wrong!")}})}}}}}function add_sample_project(a){$("#add_sample_project").val(a)}function add_phenotype_tag_cloud(a){var c="tag-cloud";var b=new Array(" orange"," darkBlue"," aqua"," brilliantBlue"," red");c+=b[parseInt(Math.random()*5)];$("#tag-info_phenotype_cloud").append('<li onclick="$(this).remove();" class="'+c+'">'+a+"</li>")}function sampleFormReset(){document.getElementById("sample_form").reset();$("#dis_no").hide();$("#phenotype_tag_div ul.tag-info").empty()}function set_value_for_new_project(){$("#myModalLabel_project").text("新建项目");$("#project_name").attr("readonly",false);$("#description").attr("readonly",false);$("#display_level_readonly").val(1);set_pro_display_level(1);$("#project_no").val("");$("#project_name").val("");$("#description").val("");$("#display_level").val(1);$("#submit_add_project").show();$("#submit_edit_project").hide()}function add_project(){var f=$("#project_name").val();var d=$("#description").val();var a=$("#display_level").val();var c=$("#project_no").val();var e=$("#pro_tab_flag").val();if(f.trim()==""){$("#project_project_name_tag").children().remove();$("#project_project_name_tag").append("<span><img src='/static/images/redTip.png'>项目名称不能为空!</span>");return false}else{if(f.trim().length>50){$("#project_project_name_tag").children().remove();$("#project_project_name_tag").append("<span><img src='/static/images/redTip.png'>项目名称最大长度为50!</span>");return false}}if(d.trim()==""){$("#project_description_tag").children().remove();$("#project_description_tag").append("<span><img src='/static/images/redTip.png'>项目描述不能为空!</span>");return false}else{if(d.trim().length>255){$("#project_description_tag").children().remove();$("#project_description_tag").append("<span><img src='../static/images/redTip.png'>项目描述不能为空!</span>");return false}}var e=$("#pro_tab_flag").val();var b="/project/add/";$.ajax({url:b,async:false,type:"POST",data:{project_no:c,project_name:f,description:d,display_level:a},success:function(g){if(g.success==true){$("#addbss2").modal("hide");if(e=="3"){$("#dashboard_header").load("/dashboard/header/",function(){$("#dashboard_project").load("/dashboard/project/",function(){})})}else{if(e=="4"){sweetAlert("添加项目成功！")}else{if(e==1){$("#my_project").load("/project/list/mine/",function(){})}else{$("#public_project").load("/project/list/public/",function(){})}}}}else{sweetAlert(g.result.message)}},error:function(){sweetAlert("Something was wrong!")}})}function edit_project(){var f=$("#project_name").val();var d=$("#description").val();var a=$("#display_level").val();var c=$("#project_no").val();var e=$("#pro_tab_flag").val();var b="/project/"+c+"/update/";if(f.trim()==""){sweetAlert("项目名称不能为空！");$("#project_name").focus();return false}else{if(f.trim().length>50){sweetAlert("项目名称最大长度为50！");$("#project_name").focus();return false}}if(d.trim()==""){sweetAlert("描述不能为空！");$("#description").focus();return false}else{if(d.trim().length>255){sweetAlert("描述最大长度为255！");$("#description").focus();return false}}var e=$("#pro_tab_flag").val();$.ajax({url:b,async:false,type:"POST",data:{project_no:c,project_name:f,description:d,display_level:a},success:function(g){if(g.success==true){$("#addbss2").modal("hide");var h=$("#id"+c).children().select("span");$("#project_name").val(h.eq(0).children().select("a").eq(0).attr("title",f));$("#description").val(h.eq(1).attr("title",d));if(f.length>10){f=f.substr(0,10)+"..."}if(d.length>20){d=d.substr(0,20)+"..."}var h=$("#id"+c).children().select("span");h.eq(0).children().select("a").eq(0).text(f);h.eq(1).text(d);$("#pro_display_level"+c).val(a)}else{sweetAlert(g.result.message)}},error:function(){sweetAlert("Something was wrong!")}})}function DeleteProject(){var g;var j=$("#project_no_delete").val();var d=$("#display_level_delete").val();var k=$("#project_name").val();var c=$("#pro_tab_flag").val();if(c=="1"){g=$("#page_change_page").val()}else{g=$("#pub_page_change_page").val()}var f=$("#project_search").val();if(f==""){f="None"}var h=$("#delete_project").val();var b=$("#delete_sample").val();if(h==1){if(b==2){var e=true}else{var e=false}var l=$("#id"+j).children().select("td");var k=l.eq(0).children().select("a").eq(0).html();var a="/project/delete_ajax/";$.ajax({url:a,type:"POST",data:{project_no:j,del_sam:e},success:function(m){if(m.success==true){if(c==1){$("#my_project").load("/project/list/mine/",function(){})}}},error:function(){swal("Something was wrong!")}})}return false}function del_project_user(d,e,c,f){var a=confirm("是否删除此用户？");if(a==true){var b="/delete/project/account/"+c+"/"+e+"/"+f+"/";$.ajax({url:b,type:"POST",data:{project_no:c,account:e,role:f},success:function(g){$(d.target).parents("tr").remove();sweetAlert("项目删除用户成功！")},error:function(){swal("Something was wrong!")}})}}function set_pro_display_level(d){var b=$("#display_level_readonly").val();if(b==1){if(d==1){$("#display_level").val(1);$("#pro_img_label01_a").addClass("proCapacity_green");$("#pro_img_label01_a").removeClass("proCapacity_gray");$("#pro_img_label02_a").addClass("proCapacity_gray");$("#pro_img_label02_a").removeClass("proCapacity_green");$("#pro_img_label02").attr("src","/static/images/right_gray.png");$("#pro_img_label01").attr("src","/static/images/right_green.png");$("#project_display_level_tag").children().remove();var a='<img class="pro_blue_tip" src="/static/images/proTip.png">';var c="<span>私有项目其他人将无法搜索到</span>";$("#project_display_level_tag").append(a);$("#project_display_level_tag").append(c)}else{$("#display_level").val(0);$("#pro_img_label01_a").addClass("proCapacity_gray");$("#pro_img_label01_a").removeClass("proCapacity_green");$("#pro_img_label02_a").addClass("proCapacity_green");$("#pro_img_label02_a").removeClass("proCapacity_gray");$("#pro_img_label01").attr("src","/static/images/right_gray.png");$("#pro_img_label02").attr("src","/static/images/right_green.png");$("#project_display_level_tag").children().remove();var a='<img class="pro_blue_tip" src="/static/images/proTip.png">';var c="<span>公开项目将对所有人开放</span>";$("#project_display_level_tag").append(a);$("#project_display_level_tag").append(c)}}else{$("#project_display_level_tag").children().remove();var a='<img class="pro_blue_tip" src="/static/images/redTip.png">';var c="<span>项目属性您没有权限修改！</span>";$("#project_display_level_tag").append(a);$("#project_display_level_tag").append(c)}}function refresh_unread_nums(){$("#m_unread_num").text($("#m_show_unread>a").length);if($("#m_show_unread a").length===0){$("#m_unread_num").hide();$("#m_no_msg").show()}else{$("#m_unread_num").show();$("#m_no_msg").hide()}}function request_other(){var a=$("#m_email").val();var c=$("#m_content").val();var b=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;if(!b.test(a)){sweetAlert("您输入的邮箱格式不正确，请重新输入");$("#m_email").focus().select();return false}if(c.length<=0){sweetAlert("输入的内容不能为空");return false}var d="/email/";$.ajax({url:d,type:"POST",async:true,data:{email:a,content:c},success:function(f){var e=JSON.parse(f);if(e.status==0){swal({title:"已邀请您的朋友"+a,text:"窗口将在3秒后消失",type:"success",timer:3000,showConfirmButton:false});$("#m_email").val("");$("#m_content").val("")}else{sweetAlert(e.message)}},error:function(e){sweetAlert("邀请失败！错误信息："+e.statusText+"错误代码："+e.status)}})}function remove_inside(a){if(a==null){$("#m_show_unread a").remove()}else{$("#m_msg_"+a).slideUp();$("#m_msg_"+a).remove()}refresh_unread_nums()}function add_inside(f){var a=document.getElementById("m_show_unread");for(var b=0;b<f.length;b++){var e=f[b];var d=document.createElement("a");d.id="m_msg_"+e.msgNo;d.onclick=function(){window.location.href="/message/"};d.className="list-group-item";var c='<table  width="100%" onMouseOver="show_right('+e.msgNo+')" onMouseOut="hide_right('+e.msgNo+')"><tr><td rowspan="2" width="52px;"><img class="icon-circularznTwo" src="/static/images/user02.png" width="42px" height="42px"></td><td>';c+=e.subject;c+='</td><td rowspan="2"><button id="m_set_read_'+e.msgNo+'" class="btn pull-right icon-circularzn" onclick="set_read(event,'+e.msgNo+');" style="display:none"><img src="/static/images/glyphicon-ok.png" title="标为已读"/></button></td></tr><tr><td class="addtime">';c+=e.date_send;c+="</td></tr></table>";d.innerHTML=c;a.appendChild(d)}refresh_unread_nums()}var lastTime="2015-8-5 09:00:00";function updateTime(){var d=new Date();var e=d.getFullYear();var g=d.getMonth()+1;if(g<10){g="0"+g}var b=d.getDate();if(b<10){b="0"+b}var a=d.getHours();if(a<10){a="0"+a}var h=d.getMinutes();if(h<10){h="0"+h}var c=d.getSeconds();if(c<10){c="0"+c}var f=e+"-"+g+"-"+b+" "+a+":"+h+":"+c;lastTime=f}function get_inside(){$.ajax({url:"/message/receive/",type:"GET",async:true,data:{read:"unread",date_send:lastTime},success:function(c){var b=JSON.parse(c);if(b.status==1){var a=b.data.length;if(a){add_inside(b.data)}else{$("#m_no_msg").show()}updateTime()}else{sweetAlert(b.message)}},error:function(a){$("#m_no_msg").html("<a href='javascript:;' onclick='get_inside()'>加载失败，点击刷新</a>")}})}function set_read(b,c){var a=b||window.event;if(a.stopPropagation){a.stopPropagation()}else{if(window.event){window.event.cancelBubble=true}}var d="/message/read/";if(arguments.length==2){d="/message/read?msgNo="+c}$.ajax({url:d,type:"GET",async:false,success:function(f){var e=JSON.parse(f);if(e.status==1){var g=location.href.split("/");if(d=="/message/read/"){remove_inside();swal({title:"已成功将"+e.data+"条信息标记为已读",text:"窗口将在2秒后消失",type:"success",timer:2000,showConfirmButton:false});if(g[g.length-2]=="message"){static_changeToRead()}}else{remove_inside(c);if(g[g.length-2]=="message"){static_changeToRead(c)}}}else{sweetAlert(e.message)}},error:function(e){swal("标记失败！错误信息："+e.statusText+"错误代码："+e.status)}})}function show_right(a){$("#m_set_read_"+a).show()}function hide_right(a){$("#m_set_read_"+a).hide()}function sendMessage(d){var c=$("#new_receiver").val();var a=$("#new_subject").val();var b=$("#new_content").val();if(c==""){swal("请填写收件人！")}else{if(a==""){swal("请填主题！")}else{if(b==""){swal("请填写回复内容！")}else{c=c.replace(/[^a-z0-9_\u4e00-\u9fa5]/gi,",");$.ajax({url:"/message/",type:"POST",async:true,data:{subject:a,content:b,to_list_str:c},success:function(f){d.disabled=false;var e=JSON.parse(f);if(e.status==1){if(e.data.no_exist_user.length!=0&&e.data.exist_user.length==0){swal('用户" '+e.data.no_exist_user+'" 不存在')}else{if(e.data.no_exist_user.length!=0&&e.data.exist_user.length!=0){swal('用户" '+e.data.no_exist_user+'" 不存在,已将信息发送至'+e.data.exist_user)}else{swal({title:"已将信息发送至"+c,text:"窗口将在2秒后消失",type:"success",timer:2000,showConfirmButton:false});$("#new_receiver").val("");$("#new_subject").val("");$("#new_content").val("");$("#new_close").click()}}var g=location.href.split("/");if(g[g.length-2]=="message"){static_addSendItem(e.data.MsgNo,c,a,b,"2015-07-24 12:00:00")}}else{sweetAlert(e.message)}},error:function(e){d.disabled=false;sweetAlert("回复失败！错误信息："+e.statusText+"错误代码："+e.status)}})}}}}var i=0;function showWait(e){var c=$(document).scrollTop();var d=$(document).scrollLeft();if(arguments.length==1){$wait=$("#wait").clone();$wait.removeAttr("id").attr("id","wait"+i).appendTo(e).css({left:(e.width()-$("#wait").width())/2,top:(e.height()-$("#wait").height())/2}).show();i++}else{var b=($(window).height()-$("#wait").height())/2;var a=($(window).width()-$("#wait").width())/2;$("#wait").css({left:a+d,top:b+c}).show()}}function hideWait(a){if(arguments.length){a.find(".wait").hide().remove()}else{$("#wait").hide()}};