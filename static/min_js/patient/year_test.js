$(function(){console.log("*************************************年页面初始化************************************");var new_date=$("#new_date").val();console.log("获取的最新日期："+new_date);var new_year=myDateClass.getYear(new_date);$(".calendar_year_mode .showDate2").val((new_year-1)+"年   至   "+new_year+"年");console.log("将日历设置为："+$(".calendar_year_mode .showDate2").val());var jsondata=eval("("+$(".saveJson").val()+")");console.log("获取所有的数据为：",jsondata);var patient_no=$("#patient_no").val();var disease=$("#disease").val();traversalJson(jsondata,new_year);$(".radio_month").click(function(){go_to_month(new_date)});$(".monthPage a").click(function(){var str_date=$(".calendar_year_mode .showDate2").val();str_date=parseInt(str_date.split("年"),10);var index=$(".monthPage a").index($(this))+1;var y_m="";if(index>12){var year=str_date+1;var month=index-12;y_m=year+"-"+month}else{var year=str_date;var month=index;y_m=year+"-"+month}go_to_month(y_m)});$(".next_y,.prev_y").click(function(){var str_date=$(".calendar_year_mode .showDate2").val();str_date=parseInt(str_date.split("年"),10)+1;traversalJson(jsondata,str_date)});$(".pablue").click(function(){if($(".pablueBox").is(":visible")){$("#gly_history").removeClass("glyphicon-minus").addClass("glyphicon-plus")}else{$("#gly_history").removeClass("glyphicon-plus").addClass("glyphicon-minus")}$(".pablueBox").slideToggle("slow");if($(".purpleBox").is(":visible")){$(".purpleBox").slideToggle("slow");$("#gly_clinic").removeClass("glyphicon-minus").addClass("glyphicon-plus")}});$(".purple").click(function(){if($(".purpleBox").is(":visible")){$("#gly_clinic").removeClass("glyphicon-minus").addClass("glyphicon-plus")}else{$("#gly_clinic").removeClass("glyphicon-plus").addClass("glyphicon-minus")}$(".purpleBox").slideToggle("slow");if($(".pablueBox").is(":visible")){$(".pablueBox").slideToggle("slow");$("#gly_history").removeClass("glyphicon-minus").addClass("glyphicon-plus")}});$("#addTestData").modal()});function go_to_month(b){showWait();var a=$("#patient_no").val();var c=$("#disease").val();$("#test_data_list").load("/sample/patient/month/"+a+"/",{month:b,disease:c},function(){console.log("load month html ok");hideWait()})}function traversalJson(f,d){console.log("*************************************刷新页面************************************");console.log("开始清除span和a的class、html、所有事件……");$(".MothBox span").removeClass().html("").unbind();$(".PastHistory a").removeClass().removeAttr("data-toggle data-content data-placement data-original-title title").html("").unbind();console.log("清除完成！");console.log("开始进行年页面遍历json日期，并填色……");for(o in f.data){if(myDateClass.isInYear(o,d)){for(p in f.data[o]){var a=myDateClass.getMonth(o)+(myDateClass.getYear(o)-d+1)*12;var c=p;var b=f.data[o][p];var e=o;addColor(a-1,c,b,e)}}}console.log("添加鼠标滑过显示弹窗的popover事件……");options={trigger:"manual",html:true,container:".MothBox"};$('[data-toggle="popover"]').popover(options).on("mouseenter",function(){var g=this;$(this).popover("show");$(".popover").children().addClass("triangle_box");$(".popover").addClass("blue_border").on("mouseleave",function(){$(g).popover("hide")})}).on("mouseleave",function(){var g=this;setTimeout(function(){if(!$(".popover:hover").length){$(g).popover("hide")}},100)});console.log("popover事件添加完成！")}function addColor(j,a,c,b){var g=$("#"+a).parents("li").children("span:eq("+j+")");if(g.html()==""){var e=0}else{e=parseInt(g.html())}g.html(e+1);var d=$("#"+a).parent().parent();if(d.hasClass("pablueBox")){g.addClass("paBlueTitle")}else{if(d.hasClass("purpleBox")){g.addClass("purpleTitle")}else{if(d.hasClass("geneticBox")){g.addClass("geneticTitle")}else{if(d.hasClass("treatBox")){g.addClass("treatTitle")}}}}g.unbind("click").click(function(){$("#"+a).parents("li").children("h5").children("a").click()});var i=$("#"+a+" a:eq("+j+")");if(i.html()==""){var f=0}else{f=parseInt(i.html())}i.html(f+1);if(d.hasClass("pablueBox")){i.addClass("paBlueBlock")}else{if(d.hasClass("purpleBox")){i.addClass("purpleBlock")}else{if(d.hasClass("geneticBox")){i.addClass("geneticBlock")}else{if(d.hasClass("treatBox")){i.addClass("treatBlock")}}}}i.attr("data-toggle","popover").attr("data-placement","right");var h=i.attr("data-content")==undefined?"":i.attr("data-content");h+='<div class="patient_mouse_content">';h+="<p>类型：<span>"+$("#"+a).children("strong").html()+"</span></p>";h+='<p style="display:none">编号：<span>'+c+"</span></p>";h+="<p>时间：<span>"+b+'</span></p><a onclick="triggerMotal(this)">查看详细</a></div>';i.attr("data-content",h)}function triggerMotal(b){var a=$(b).parent(".patient_mouse_content").find("span:eq(1)").html();var c=$(b).parent(".patient_mouse_content").find("span:eq(0)").html();console.log("获取的编号和类型为："+a+c);attribute_list(a,c)}function attribute_list(b,c){showWait();var a=$("#patient_no").val();url="/sample/patient/"+a+"/"+b+"/";$.ajax({url:url,type:"POST",data:{},success:function(i){var d=i.data;console.log(d);var g=$("#attributes_listss");var e=$("#attributes_list");e.remove();g.append($("<ul id='attributes_list'></ul>"));e=$("#attributes_list");for(key in d){var f=key;var h=d[key];var j=$("<li>"+f+":"+h+"</li>");e.append(j)}hideWait();$("#attribute_list").modal();$(".myMotalTitle").html(c)},error:function(){sweetAlert("something was wrong!")}})};