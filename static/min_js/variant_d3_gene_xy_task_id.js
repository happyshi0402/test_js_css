var array_gene_for_d3_json;var task_id=$("#variant_hid_task_id").val();var max_gene_count=0;var min_gene_count=0;var gene_size;showWait_for_d3($("#variant_d3_table"));if($("#variant_hid_app2").val()=="5"){d3.json("/variant/gene/d3_show_json/analysisapptwo/"+task_id+"/",function(a){$("#wait2").hide();array_gene_for_d3_json=a;paint_d3_gene_pic_load()})}else{d3.json("/variant/gene/d3_show_json/group/"+task_id+"/",function(a){$("#wait2").hide();array_gene_for_d3_json=a;paint_d3_gene_pic_load()})}var variant_gene_svg_color=["#cc3216","#ee5438","#eeb438","#78d666"];function color(a){var b=a;if(b==0){return variant_gene_svg_color[0]}if(b>0&&b<=0.01){return variant_gene_svg_color[1]}if(b>0.01&&b<=0.05){return variant_gene_svg_color[2]}if(b>0.05&&b<=1){return variant_gene_svg_color[3]}}var diameter=$(window).width()-30,height=420;format=d3.format(",d");function paint_d3_gene_pic_load(){$("#variant_d3_pic_div1").children().remove();$("#variant_d3_pic_div2").children().remove();$("#variant_d3_pic_div3").children().remove();$("#variant_gene_count").val(1);$("#variant_gene_shift_score").val(100);var a=classes(array_gene_for_d3_json);$("#variant_gene_text_count").val(a.children.length);max_gene_count=d3.max(a.children,function(b){return b.value});min_gene_count=d3.min(a.children,function(b){return b.value});gene_size=parseInt(max_gene_count);$("#variant_gene_count").val(parseInt(gene_size/5));paint_d3_control_gene_show(array_gene_for_d3_json,"variant_d3_pic_div1","variant_d3_pic_div2","variant_gene_count",gene_size,max_gene_count);paint_d3_control_gene_show(array_gene_for_d3_json,"variant_d3_pic_div3","variant_d3_pic_div2","variant_gene_shift_score",100,100);$("#variant_gene_shift_score").val(100);paint_d3_for_variant_gene("variant_d3_pic_div2",array_gene_for_d3_json,diameter)}function paint_d3_control_gene_show(k,f,e,n,m,l){var g=height-110;var i=d3.select("td#"+f).append("svg").attr("width",110).attr("height",g).attr("class","bubble");var o=[{x:50,y:g*0.9}];var c=g*0.9;var b=parseInt(m)*c/l;i.selectAll("rect3").data(o).enter().append("rect").attr({id:"rect3"+n,x:function(p){return p.x},y:g*0.05,rx:5,ry:5,width:14,height:g*0.9}).style({fill:"#e8e8e8"}).on("click",function(){$("#"+e).children().remove();var r=d3.select("#rect4"+n);var p=$(document).scrollTop()-200;if(n=="variant_gene_shift_score"){var q=d3.event.y+p-c;var d=q;j=parseInt((b+d)/(c)*l)}else{var q=d3.event.y+p-c;var d=q;j=parseInt((b+d)/(c)*l)}if(j==0||j==l){}if(j<1||j>=l){if(j<1){j=1}if(j>l){j=l}}if(n=="variant_gene_shift_score"){$("#"+n).val(j)}else{$("#"+n).val(l-j+1)}r.attr("transform","translate(0,"+q+")");paint_d3_for_variant_gene("variant_d3_pic_div2",k,diameter)});i.selectAll("rect4").data(o).enter().append("rect").attr({id:"rect4"+n,x:function(p){return p.x-4},rx:4,ry:4,y:g*0.05+parseInt(m)*g*0.9/l-4,width:22,height:10}).style({fill:"#0cafe2"});var a=0;var j=0;var h=d3.behavior.drag().origin(Object).on("drag",function(){if(k!=null){a=d3.event.y;j=parseInt((b+a)/(c)*l);if(j==0||j==l){}if(j<1||j>=l){if(j<1){j=1}if(j>l){j=l}}else{d3.select(this).attr("transform","translate(0,"+d3.event.y+")").datum({x:0,y:d3.event.y})}}}).on("dragend",function(){if(k!=null){if(n=="variant_gene_shift_score"){$("#"+n).val(j)}else{$("#"+n).val(l-j+1)}$("#"+e).children().remove();paint_d3_for_variant_gene("variant_d3_pic_div2",k,diameter)}});i.select("#rect4"+n).datum({x:0,y:0}).call(h)}function paint_d3_for_variant_gene(f,b,d){var a=d3.layout.pack().sort(null).size([d/3-100,height+200]).padding(1.5);var c=d3.select("#"+f).append("svg").attr("width",d-280).attr("height",height).attr("class","bubble");if(b!=null){var e=c.selectAll(".node").data(a.nodes(classes(b)).filter(function(g){return !g.children})).enter().append("g").attr("class","node").attr("transform",function(h){var g=3;return"translate("+g*h.x+","+0.7*h.y+")"});e.append("title").text(function(g){return"����:"+g.className+",�²��Դ��:"+parseFloat(g.packageName)+",ͻ����Ŀ: "+format(g.value)}).on("click",function(g){if(filter_sign==false){searchGene2(g.className)}else{searchGene(g.className)}});e.append("circle").attr("r",function(g){return g.r}).attr("class","svg_gene_circle").attr("style","cursor: pointer;").style("fill",function(g){return color(g.packageName)}).on("click",function(g){if(filter_sign==false){searchGene2(g.className)}else{searchGene(g.className)}}).on("mouseover",function(g){d3.select(this).style({stroke:"green","stroke-width":5,"fill-opacity":0.7})}).on("mouseout",function(g){d3.select(this).style({stroke:"","stroke-width":0,"fill-opacity":1})});e.append("text").attr("dy",function(g){if(g.r>50){return".2em"}else{}}).style("text-anchor","middle").text(function(g){if(g.className==undefined||g.className==null){return""}else{return g.className.substring(0,g.r/3)}})}else{alert("data is null!")}}function paint_d3_for_variant_gene_disease_pack(a,h,d,j,i){var f=["#d30505","#f92a2a","#fd5454","#d9c201","#f8e22c","#f8e969","#0579d3","#259af5","#67b7f5","#64f360","#64f310"];function c(l){for(var k=0;k<=10;k++){if(l>=k*10&&l<=(k+1)*10){return f[10-k]}}}var g=d3.layout.pack().sort(null).size([j/3,i]).padding(1.9);var e=d3.select("#"+a).append("svg").attr("width",j-30).attr("height",i-40).attr("class","bubble");if(h!=null){var b=e.selectAll(".node").data(g.nodes(classes_disease(h,d)).filter(function(k){return !k.children})).enter().append("g").attr("class","node").attr("transform",function(l){var k=3;return"translate("+k*l.x+","+0.7*l.y+")"});b.append("title").text(function(k){if(k.packageName!="100"){return"����:"+k.className+",����Դ��:0."+k.packageName+",������: "+format(k.value)+",�������:"+k.association_type}else{return"����:"+k.className+",����Դ��:0.:1.00,������:: "+format(k.value)+",�������:"+k.association_type}}).on("click",function(k){});b.append("circle").attr("r",function(k){return k.r}).attr("class","svg_gene_circle").attr("style","cursor: pointer;").style("fill",function(k){return c(k.packageName/10)}).on("click",function(k){}).on("mouseover",function(k){d3.select(this).style({stroke:"green","stroke-width":5,"fill-opacity":0.7})}).on("mouseout",function(k){d3.select(this).style({stroke:"","stroke-width":0,"fill-opacity":0.5})});b.append("text").attr("dy",function(k){if(k.r>50){return".2em"}else{}}).style("text-anchor","middle").text(function(k){if(k.className==undefined||k.className==null){return""}else{return k.className.substring(0,k.r/4)}})}else{alert("data is null!")}}function paint_d3_for_variant_gene_disease_bar(b,l,f,o,n){var h=["#EF3B39","#FFCD05","#69C9CA","#666699","#CC3366","#0099CC","#CCCB31","#009966","#C1272D","#F79420","#445CA9","#999999","#402312","#272361","#A67C52","#016735","#F1AAAF","#FBF5A2","#A0E6DA","#C9A8E2","#F190AC","#7BD2EA","#DBD6B6","#6FE4D0"];function d(r){for(var q=0;q<=10;q++){if(r>(q-1)*10&&r<=q*10){return h[10-q]}}}var i=d3.layout.pack().sort(null).size([o/3,n]).padding(1.9);var g=d3.select("#"+b).append("svg").attr("width",o-30).attr("height",n-40).attr("class","bubble");if(l!=null){var e=classes_disease2(l,f);e.sort(function(r,q){if(r.packageName>q.packageName){return -1}if(r.packageName<q.packageName){return 1}return 0});if(e.length>40){e=e.slice(0,40)}e.sort(function(r,q){if(r.value>q.value){return -1}if(r.value<q.value){return 1}return 0});if(e.length>20){e=e.slice(0,20)}var a=o-100,n=n,c=20,p=100;var m=d3.scale.linear().range([c,a]);var k=d3.scale.ordinal().rangeRoundBands([c,n-c],0.2);m.domain([0,d3.max(e,function(q){return q.value})]);k.domain(e.map(function(q){return q.className}));var j=g.selectAll("rect").data(e).enter().append("g");j.append("rect").attr("class","bar").attr("style","cursor: pointer;").style("fill",function(q){return d(q.packageName/10)}).style("fill-opacity",function(q){if(q.packageName==0){return 0}else{return 1.2}}).style({"stroke-width":function(q){if(q.packageName!=0){return 0}else{return 1}},stroke:function(q){return d(q.packageName/10)}}).attr("x",-a).transition().duration(800).attr("rx",function(){if(k.rangeBand()>20){return 20/3}else{return k.rangeBand()/3}}).attr("ry",function(){if(k.rangeBand()>20){return 20/3}else{return k.rangeBand()/3}}).attr("x",function(q){return m(0)}).attr("width",function(q){if(q.value==0){return m(0.5)}else{return m(q.value)}}).attr("id",function(q){return"bar"+parseInt(m(q.className))}).attr("y",function(q){return k(q.className)-c+k.rangeBand()/2}).attr("height",function(q){if(k.rangeBand()>20){if(q.packageName!=0){return 20}else{return 20-1}}else{if(q.packageName!=0){return k.rangeBand()}else{return k.rangeBand()-1}}});j.append("title").attr("fill",function(q){return d(q.packageName/10)}).attr("stroke","black").text(function(q){if(q.packageName!="100"){return"����:"+q.className+",����Դ��:0."+q.packageName+",������: "+format(q.value)+",�������:"+q.association_type}else{return"����:"+q.className+",����Դ��:0.:1.00,������:: "+format(q.value)+",�������:"+q.association_type}});j.append("text").attr("dx",m(0)+10).attr("dy",function(q){return k(q.className)+k.rangeBand()/2-c/3}).style("text-anchor","right").text(function(q){if(q.className==undefined||q.className==null){return""}else{return q.className}})}else{alert("data is null!")}}function classes_disease(a,d){var b=[];function c(e,f){if(f.children){if(f.name==d){f.children.forEach(function(g){c(f.name,g)})}}else{b.push({packageName:f.score,className:f.name,value:f.size,association_type:f.association_type})}}c(null,a);return{children:b}}function classes_disease2(a,d){var b=[];function c(e,f){if(f.children){if(f.name==d){f.children.forEach(function(g){c(f.name,g)})}}else{b.push({packageName:f.score,className:f.name,value:f.size,association_type:f.association_type})}}c(null,a);return b}function classes(a){var g=$("#variant_gene_count").val();var f=100-$("#variant_gene_shift_score").val();var d=[];var c=">=";var b=">=";function e(i,l,m,k,j,h){if(l.children){if(l.name=="gene"){l.children.forEach(function(n){e(l.name,n,m,k,j,h)})}else{if(h==">="){if(parseInt(l.name)>=k){l.children.forEach(function(n){e(l.name,n,m,k,j,h)})}}else{if(h=="="){if(parseInt(l.name)==k){l.children.forEach(function(n){e(l.name,n,m,k,j,h)})}}else{if(h=="<="){if(parseInt(l.name)<=k){l.children.forEach(function(n){e(l.name,n,m,k,j,h)})}}}}}}else{if(j==">="&&h==">="){if(l.size>=m&&parseInt(l.score)>=k){d.push({packageName:l.score,className:l.name,value:l.size})}}else{if(j=="="&&h==">="){if(l.size==m&&parseInt(l.score)>=k){d.push({packageName:l.score,className:l.name,value:l.size})}}else{if(j=="<="&&h==">="){if(l.size<=m&&parseInt(l.score)>=k){d.push({packageName:l.score,className:l.name,value:l.size})}}}}}}e(null,a,g,f,c,b);return{children:d}}d3.select(self.frameElement).style("height",height+"px");